#include "SigProcThread.h"
#define RAW_SAMPLE_NUMBER 1024
LOG_MODULE_REGISTER(eegals_app_core_sig_proc, LOG_LEVEL_DBG);
K_THREAD_STACK_DEFINE(sig_proc_stack_area, SIG_PROC_THREAD_STACK_SIZE_B);
struct k_thread sig_proc_thread_data;

// float32_t inputSignal[1024] = { 2, 1.80075512683121,
// 		1.27637053325758, 0.618871900194794, 0.0656112591359919,
// 		-0.191339455865792, -0.0783815301685531, 0.331835982653282,
// 		0.848683105690253, 1.23703243919349, 1.30782963716736,
// 		0.991081272267325, 0.363318387328728, -0.380984958988108,
// 		-1.00311152015435, -1.31072642475088, -1.23075864316698,
// 		-0.836658892316524, -0.319613844304356, 0.085256675713322,
// 		0.18946595086915, -0.0761778607350844, -0.634629641347059,
// 		-1.29170265140208, -1.81007298891733, -1.99987740193588,
// 		-1.79123725544972, -1.26095670117884, -0.603178660320141,
// 		-0.055227473550539, 0.19298482290168, 0.0713230284307791,
// 		-0.344124006639894, -0.860628317265312, -1.24311072794513,
// 		-1.3046941854389, -0.97885947218502, -0.345580036463151,
// 		0.398576279966024, 1.01494806225932, 1.31338452620669, 1.2242914477948,
// 		0.824559098692983, 0.307461008406392, -0.0919463687446093,
// 		-0.187364341589039, 0.0869251213230042, 0.650448423763655,
// 		1.30694961281731, 1.81918873101962, 1.99950963558065, 1.78152153049895,
// 		1.24546461515889, 0.587553364544898, 0.0450286160318735,
// 		-0.194402073812635, -0.0640833116044239, 0.356474482558199,
// 		0.872491122976763, 1.24899144667981, 1.30132014715989,
// 		0.966448318258434, 0.327773394658798, -0.416088896391288,
// 		-1.02658879026102, -1.3158039751626, -1.21763300569042,
// 		-0.812387163040206, -0.295380874069326, 0.0984485582246206,
// 		0.185034717211766, -0.0978508394086913, -0.666324771053142,
// 		-1.32210799271628, -1.82810028798402, -1.9988967844391,
// 		-1.77161015223518, -1.22989775157466, -0.571999437690082,
// 		-0.0350167531666887, 0.195591285938577, 0.0566645650685716,
// 		-0.368883960624066, -0.884268137051713, -1.25467257833485,
// 		-1.29770765552429, -0.953850053090931, -0.309901966159377,
// 		0.433519372804555, 1.03803164159439, 1.31798486084284, 1.21078551363811,
// 		0.80014653943435, 0.283376821893338, -0.104761238886249,
// 		-0.18247722241546, 0.108952769550704, 0.682255191263156,
// 		1.33717438512593, 1.83680564067701, 1.99803898766405, 1.76150536492697,
// 		1.21425960236898, 0.556520285770927, 0.0251939055912087,
// 		-0.196552592101412, -0.0490690179572051, 0.381348975793684,
// 		0.89595599281307, 1.26015215200849, 1.29385689930048, 0.941066963016002,
// 		0.291969270365277, -0.450864292961743, -1.0492745999304,
// 		-1.3199273280408, -1.20375121206907, -0.787840696987264,
// 		-0.271452213166754, 0.11088245171035, 0.179692057339779,
// 		-0.120228622883534, -0.698236177701296, -1.35214540368849,
// 		-1.84530281646085, -1.99693644002359, -1.75120945632699,
// 		-1.19855367422904, -0.541119295196356, -0.0155620475179817,
// 		0.197286180569813, 0.0412989426291329, -0.393866048585559,
// 		-0.907551343478945, -1.26542824343049, -1.28976812279299,
// 		-0.928101377564622, -0.273978841010309, 0.468120260632887,
// 		1.06031569564496, 1.32163157707869, 1.19653238452739, 0.775473119023139,
// 		0.259610389068651, -0.116810284391981, -0.176679477542519,
// 		0.13167606765412, 0.71426420975962, 1.3670176824584, 1.85358988965794,
// 		1.99558939185523, 1.74072475713343, 1.18278348776133, 0.525799831972987,
// 		0.00612310627365042, -0.197792295010928, -0.0333566541277167,
// 		0.406431685905934, 0.919050862957172, 1.27049897542178,
// 		1.28544162579118, 0.914955668922524, 0.255934225335179,
// 		-0.485283900396366, -1.07115300627695, -1.32309786375408,
// 		-1.18913135712569, -0.76304730225176, -0.247854669876041,
// 		0.122542871795759, 0.173439793943157, -0.143292729768551,
// 		-0.730335753742223, -1.38178787669423, -1.86166498200407,
// 		-1.99399814900695, -1.7300536404415, -1.16695257666326,
// 		-0.510565240914145, 0.00312103815220988, 0.198071234429,
// 		0.0252445096304786, -0.419042381877525, -0.930451246635121,
// 		-1.275362518343, -1.28087776350482, -0.901632251377376,
// 		-0.237838983257653, 0.502351858428187, 1.08178465697497,
// 		1.32432649927341, 1.1815504979909, 0.750566755938565, 0.236188354176144,
// 		-0.128078396399944, -0.169973372753289, 0.155076193348639,
// 		0.746447263696133, 1.39645266364577, 1.86952626309051, 1.99216307276525,
// 		1.71919852118481, 1.15106448689183, 0.495418844853675,
// 		-0.012168553547071, -0.198123353090918, -0.0169649078887981,
// 		0.431694618671093, 0.941749212164467, 1.28001709053186, 1.2760769464866,
// 		0.888133580755967, 0.219696686539878, -0.519320803286127,
// 		-1.09220882093298, -1.32531785017241, -1.17379221669998,
// 		-0.738035001071919, -0.224614718083646, 0.133415088729353,
// 		0.166280635394072, -0.167024001298564, -0.762595182244993,
// 		-1.41100874333597, -1.87717195079494, -1.99008457977004,
// 		-1.70816185556704, -1.13512277582942, -0.480363943865211,
// 		0.0210176559041227, 0.197949060438752, 0.00852028865782894,
// 		-0.444384867340097, -0.952941500240532, -1.28446095872919,
// 		-1.27103964054162, -0.874462153851727, -0.201510917952747,
// 		0.536187426688684, 1.10242371981461, 1.32607233822351, 1.16585896370598,
// 		0.725455569527427, 0.213137014463422, -0.138551227776952,
// 		-0.162362058400573, 0.179133655881127, 0.778775941425553,
// 		1.42545283933746, 1.88460031170087, 1.98776314191661, 1.69694614048376,
// 		1.11913101144677, 0.465403814486552, -0.0296666098396163,
// 		-0.197548820989222, 8.68678833576553e-05, 0.457109588657728,
// 		0.964024875376444, 1.28869243849353, 1.26576636662388,
// 		0.860620507842648, 0.18328527043784, -0.552948444288399,
// 		-1.11242762416597, -1.32659044033021, -1.15775322975451,
// 		-0.712832003229882, -0.201758472158651, 0.143485141413962,
// 		0.158218173313147, -0.191402619303552, -0.794985963526529,
// 		-1.43978169954349, -1.89180966150572, -1.98519928624452,
// 		-1.68555391293468, -1.1030927714635, -0.45054170894984,
// 		0.038113728998689, 0.196923154220201, -0.00885404172118132,
// 		-0.469865233956576, -0.974996126671504, -1.29270989460432,
// 		-1.26025770071964, -0.84661121969927, -0.165023346266834,
// 		0.56960059643982, 1.12221885381702, 1.32687268840846, 1.14947754529057,
// 		0.700167853312733, 0.190482295224737, -0.14821520678838,
// 		-0.153849566555819, 0.203828314312796, 0.811221661929893,
// 		1.45399209693312, 1.89879836541722, 1.98239359481355, 1.67398774942675,
// 		1.08701164250677, 0.435780854417296, -0.046357376449606,
// 		-0.196072634444223, 0.0177786736061182, 0.482648245970381,
// 		0.985852068573963, 1.29651174145342, 1.2545142737181, 0.832436905583999,
// 		0.146728756198806, -0.58614064896148, -1.13179577827139,
// 		-1.3269196692551, -1.14103447985618, -0.687466679275361,
// 		-0.179311662168682, 0.152739850712032, 0.149256879301711,
// 		-0.216408124800394, -0.827479441954396, -1.46808083033105,
// 		-1.90556483853833, -1.97934670456668, -1.66225026536746,
// 		-1.07089121926701, -0.421124452222999, 0.0543959650664111,
// 		0.194997890669077, -0.0268581656609949, -0.495455059678057,
// 		-0.996589541637551, -1.30009644342499, -1.24853677126876,
// 		-0.818100220240352, -0.128405118635327, 0.602565393891747,
// 		1.14115681708416, 1.32673202440333, 1.13242664147869, 0.674732048138587,
// 		0.168249725195213, -0.157057550035704, -0.144440807325512,
// 		0.229139396416093, 0.843755701700562, 1.48204472516033,
// 		1.91210754624019, 1.97605930718011, 1.65034411444943, 1.05473510365281,
// 		0.406575677120938, -0.0622279578996435, -0.193699606445422,
// 		0.0360898819978424, 0.508282103149098, 1.00720541327211,
// 		1.3034625152635, 1.24232593362617, 0.803603856373997, 0.110056058774336,
// 		-0.618871650238696, -1.15030044022838, -1.32631044996535,
// 		-1.12365667605019, -0.661967533598311, -0.157299609458423,
// 		0.161166832012598, 0.139402100843172, -0.242019437190691,
// 		-0.860046832897963, -1.49588063418991, -1.91842500452346,
// 		-1.97253214890052, -1.63827198802594, -1.03854690394302,
// 		-0.392137676538795, 0.0698518685354581, 0.19217851970162,
// 		-0.0454711493443437, -0.52112579839138, -1.01769657848788,
// 		-1.30660852243, -1.23588255548175, -0.788950544023901,
// 		-0.0916852077613286, 0.635056264723717, 1.15922516844918,
// 		1.32565569646203, 1.11472726669763, 0.649176715177257,
// 		0.146464412320124, -0.165066274649831, -0.134141564338533,
// 		0.255045518168112, 0.876349221753867, 1.50958543827504,
// 		1.92451578036757, 1.96876603036931, 1.62603661447709, 1.02233023393841,
// 		0.377813569838977, -0.0772662614425078, -0.19043542256566,
// 		0.0549992576784991, 0.533982562199453, 1.02805996063303,
// 		1.30953308144636, 1.22920748578263, 0.774143049925539,
// 		0.0732962018405579, -0.651116112518042, -1.16792957360627,
// 		-1.32476856863986, -1.10564113314471, -0.636363177376197,
// 		-0.135747202614912, 0.16875450704796, 0.1286600563774,
// 		-0.268214874045398, -0.892659249802617, -1.52315604709137,
// 		-1.93037849206809, -1.96476180643423, -1.61364075856821,
// 		-1.00608871211148, -0.363606447585476, 0.0844697523071192,
// 		0.188471161174325, -0.0646714608723166, -0.546848807004853,
// 		-1.03829251212498, -1.31223486022748, -1.22230162753799,
// 		-0.759184176865069, -0.0548926815038182, 0.667048097973404,
// 		1.17641227900425, 1.32364992527511, 1.09640103106479, 0.623530508822915,
// 		0.125151019921536, -0.172230209728477, -0.122958489408621,
// 		0.281524703822309, 0.908973294757311, 1.53658939986228,
// 		1.93601180956198, 1.96052038594803, 1.60108722079863, 0.989825960754864,
// 		0.349519370818188, -0.0914610083561966, -0.186286635469582,
// 		0.0744849773442059, 0.559720941727329, 1.04839121517438,
// 		1.31471257840144, 1.21516593761224, 0.744076763024615,
// 		0.0364782906385916, -0.682849155345053, -1.1846719597108,
// 		-1.32230067896514, -1.0870097514252, -0.610682301421201,
// 		-0.114678873841637, 0.175492114949101, 0.117037829552606,
// 		-0.29497217145847, -0.92528773136095, -1.54988246607908,
// 		-1.94141445474065, -1.95604273155461, -1.58837883674291,
// 		-0.97354560513001, -0.335555370333847, 0.0982387486679656,
// 		0.183882798982307, -0.0844369907190372, -0.572595372626188,
// 		-1.05835308250242, -1.31696500761741, -1.207801426506,
// 		-0.728823681320303, -0.0180566756761675, 0.698516249508114,
// 		1.19270734286267, 1.32072179590724, 1.0774701198239, 0.597822149498652,
// 		0.104333743285311, -0.178539007006921, -0.110899096377167,
// 		0.308554406539135, 0.941598932239619, 1.56303224621426,
// 		1.94658520175083, 1.95132985946243, 1.57551847638344, 0.957251272613833,
// 		0.321717445974211, -0.104801744470502, -0.18126065860333,
// 		0.0945246504974748, 0.585468504153565, 1.06817515805095,
// 		1.31899097184132, 1.20020915812406, 0.71342783873062,
// 		-0.000368515262398821, -0.714046376666928, -1.20051720795948,
// 		-1.31891429566466, -1.06778499581693, -0.584953648953489,
// 		-0.0941185757637908, 0.181369722529221, 0.104543362660506,
// 		-0.322268504949579, -0.957903268755573, -1.57603577242742,
// 		-1.95152287728315, -1.94638283920516, -1.56250904343484,
// 		-0.940946591845586, -0.308008565921572, 0.111148819428067,
// 		0.178421274341891, -0.104745072732188, -0.598336739806856,
// 		-1.07785451768481, -1.3207893476393, -1.19239024953093,
// 		-0.69789217561833, 0.0187936332192005, 0.729436565056135,
// 		1.20810038714501, 1.3168792509201, 1.0579572722391, 0.572080396401927,
// 		0.0840362866901538, -0.183983150751964, -0.0979717541420083,
// 		0.336111529556313, 0.974197111860472, 1.58889010926375,
// 		1.95622636084832, 1.94120279339005, 1.54935347466071, 0.924635191873583,
// 		0.294431666001732, -0.117278849914718, -0.175365759071569,
// 		0.11509534071295, 0.611196482982238, 1.08738826988734, 1.32235906444847,
// 		1.1843458706938, 0.68221966504321, -0.0372150292532425,
// 		-0.744683875635399, -1.21545576547632, -1.31461778721679,
// 		-1.0479898745158, -0.559205988324804, -0.0740897586867497,
// 		0.186378233785848, 0.0911854492602396, -0.350080510897231,
// 		-0.990476832948933, -1.60159235434482, -1.96069458504087,
// 		-1.93579089743359, -1.5360547391823, -0.908320701301696,
// 		-0.28098964899473, 0.123190765275912, 0.172095278263714,
// 		-0.125572505659024, -0.624044137827656, -1.09677355644758,
// 		-1.3236991048356, -1.17607724421308, -0.666413312067762,
// 		0.0556290552945289, 0.759785402775537, 1.22258228118015,
// 		1.31213108268698, 1.03788575996757, 0.546334020214212,
// 		0.0642818409010787, -0.188553966869883, -0.0841856788787528,
// 		0.364172447878841, 1.00673880471228, 1.61413963905167, 1.96492653579046,
// 		1.93014837928496, 1.52261583778005, 0.89200674743535, 0.267685383952842,
// 		-0.128883548077374, -0.168611049708479, 0.136173587419092,
// 		0.636876110096373, 1.10600755314031, 1.32480850474302, 1.16758564504048,
// 		0.650476153055159, -0.0740320649975109, -0.774738274937223,
// 		-1.22947892589703, -1.30942036776809, -1.02764791710725,
// 		-0.53346808572051, -0.0546153483290841, 0.190509398612453,
// 		0.076973725999106, -0.378384308481085, -1.02297940199175,
// 		-1.62652912920006, -1.96892125260059, -1.92427651913674,
// 		-1.50903980218696, -0.875696955429005, -0.254521705527769,
// 		0.134356234341304, 0.164914343223511, -0.146895575178694,
// 		-0.649688807999253, -1.11508747039697, -1.32568635372197,
// 		-1.15887240018483, -0.63441125496008, 0.0924204145939158,
// 		0.789539655341289, 1.23614474491257, 1.30648692490658, 1.01727936492981,
// 		0.520611775800028, 0.0450930611470003, -0.192243631219722,
// 		-0.069550925462131, 0.392713030469106, 1.03919500263089,
// 		1.6387580257073, 1.97267782877466, 1.9181766491237, 1.49532969437561,
// 		0.859394947433255, 0.241501413304483, -0.139607913770189,
// 		-0.161006480350251, 0.157735428174802, 0.662478643057108,
// 		1.12401055396978, 1.32633179515351, 1.14993888840549, 0.618221714612147,
// 		-0.110790463745607, -0.804186742631209, -1.24257883737619,
// 		-1.30333208824945, -1.00678315219458, -0.507768677862955,
// 		-0.0357177240509789, 0.193755820711427, 0.0619186636364494,
// 		-0.40715552211298, -1.05538198832791, -1.65082356525115,
// 		-1.9761954116294, -1.91185015300927, -1.48148860583712,
// 		-0.843104341742955, -0.228627271144354, 0.144637729957765,
// 		0.156888834038281, -0.168690076417817, -0.675242030952159,
// 		-1.13277408558655, -1.32674402645648, -1.14078653989377,
// 		-0.601910657992005, 0.129138576395942, 0.818676771527027,
// 		1.24878035650736, 1.29995724332375, 0.996162356700917,
// 		0.494942374922531, 0.0264920456053174, -0.195045177123992,
// 		-0.0540783780951699, 0.421708662913672, 1.07153674548651,
// 		1.66272302092017, 1.97947320269565, 1.90529846585968, 1.46751965685382,
// 		0.826828751946505, 0.215902006536338, -0.149444880587373,
// 		-0.15256282831723, 0.179756421419985, 0.687975392378128,
// 		1.14137538359741, 1.32692229928291, 1.13141683594205, 0.585481239501158,
// 		-0.14746112162077, -0.833007013470823, -1.25474850978874,
// 		-1.29636382670381, -0.985420084556891, -0.482136444744894,
// 		-0.0174186975991744, 0.19611096470082, 0.0460315572804398,
// 		-0.436369304336055, -1.08765566606617, -1.67445370285551,
// 		-1.98251045790626, -1.89852307370633, -1.45342599576494,
// 		-0.810571786075808, -0.203328309956866, 0.154028617617568,
// 		0.148029937956823, -0.190931336930983, -0.700675153890183,
// 		-1.14981180361299, -1.32686591970062, -1.12183130860094,
// 		-0.568936641224471, 0.165754474478151, 0.847174777263531,
// 		1.26048255914687, 1.29255332566644, 0.974559469441107, 0.46935445900012,
// 		0.00850031441197119, -0.196952502069893, -0.0377797401556301,
// 		0.451134270548832, 1.10373514843113, 1.686012958884, 1.98530648777135,
// 		1.89152551319572, 1.43921079822549, 0.794337045757543,
// 		0.190908834238423, -0.158388247454678, -0.143291688114879,
// 		0.202211669679662, 0.713337748752027, 1.15808073913339, 1.3265742483629,
// 		1.11203154032444, 0.552280072186782, -0.184015016855748,
// 		-0.861177409692946, -1.26598182111975, -1.28852727783436,
// 		-0.963583671858595, -0.456599982415499, 0.000260507612374616,
// 		0.197569162408403, 0.0293245158461947, -0.466000359170108,
// 		-1.11977159819704, -1.69739817514236, -1.98786065754046,
// 		-1.884307371228, -1.42487726645941, -0.778128125366853,
// 		-0.178646193947043, 0.162523131112823, 0.13834965397343,
// 		-0.213594240122367, -0.725959617782666, -1.16617962216882,
// 		-1.32604670066545, -1.10201916360328, -0.535514767602852,
// 		0.202239138317875, 0.875012296152781, 1.27124566701164,
// 		1.28428727080756, 0.952495878389646, 0.443876571929435,
// 		-0.00886121078224222, -0.197960373594587, -0.0206675232681875,
// 		0.480964342020295, 1.13576142907705, 1.70860677669244, 1.99017238735207,
// 		1.87687028458331, 1.41042862850559, 0.761948611181585,
// 		0.166542964768845, -0.166432684360792, -0.133205460363029,
// 		0.225075843197616, 0.738537210200896, 1.17410592385074, 1.3252827468904,
// 		1.0917958605864, 0.518643988120867, -0.220423236949753,
// 		-0.88867686125262, -1.27627352303513, -1.27983494178304,
// 		-0.941299300933098, -0.431187775847928, 0.0172992766658859,
// 		0.198125618346695, 0.0118104507452467, -0.496022965880339,
// 		-1.15170106372512, -1.71963622812722, -1.99224115237009,
// 		-1.86921593953647, -1.39586813745823, -0.745802080539292,
// 		-0.154601682905786, 0.170116377856215, 0.127860781375312,
// 		-0.236653249086756, -0.751066984467691, -1.18185715503388,
// 		-1.32428191233729, -1.08136336269075, -0.50167101906028,
// 		0.238563720200519, 0.902168569418585, 1.28106487044008,
// 		1.27517197716278, 0.929997175943297, 0.418537133002877,
// 		-0.0255722266900764, -0.19806443434887, -0.00275503561401513,
// 		0.511172953256116, 1.16758693457797, 1.73048403416757, 1.99406648290741,
// 		1.86134607146014, 1.38119907070169, 0.729692100996091,
// 		0.142824844480516, -0.173573737266541, -0.122317339964052,
// 		0.248323203979863, 0.76354540912684, 1.18943086688923, 1.32304377744122,
// 		1.07072345019954, 0.484599169644031, -0.256657005723602,
// 		-0.915484925484915, -1.28561924562958, -1.27030011215007,
// 		-0.918592763661456, -0.405928171911795, 0.0336776227286081,
// 		0.197776414364248, -0.00649693618246228, -0.526411003148869,
// 		-1.18341548469427, -1.7411477402497, -1.99564796453645,
// 		-1.85326246441615, -1.36642472913872, -0.713622229486974,
// 		-0.131214904951306, 0.17680434337732, 0.116576907534427,
// 		-0.260082430848536, -0.775968963642925, -1.19682465148679,
// 		-1.32156797787794, -1.05987795184874, -0.467431772224424,
// 		0.274699522214748, 0.928623475275261, 1.28993624026302,
// 		1.26522113033464, 0.907089347341577, 0.393364409942136,
// 		-0.0416130676823119, -0.19726120633482, 0.0159436305123112,
// 		0.541733791830284, 1.19918316859151, 1.75162493310252, 1.99698523818672,
// 		1.84496695073591, 1.35154843641431, 0.697596011490958,
// 		0.119774278535598, -0.179807832187105, -0.110641303521037,
// 		0.271927630222755, 0.78833413923687, 1.20403614236935, 1.31985420465591,
// 		1.0488287444027, 0.45017218150461, -0.292687710247175,
// 		-0.941581806175466, -1.29401550134601, -1.25993686326579,
// 		-0.895490232470672, -0.380849352475612, 0.0493762060481846,
// 		0.196518513468497, -0.0255831654838306, -0.557137973624417,
// 		-1.21488645307983, -1.76191324131622, -1.99807800022935,
// 		-1.83646141058859, -1.3365735381333, -0.681616980196115,
// 		-0.108505337644464, 0.182583894989614, 0.104512394954775,
// 		-0.283855480974334, -0.80063743971827, -1.21106301511661,
// 		-1.3179022041954, -1.03757775221761, -0.432823773753813,
// 		0.310618023104418, 0.954357547695296, 1.29785673130744,
// 		1.25444919001499, 0.883798745983575, 0.368386492077448,
// 		-0.0569647244799026, -0.195548094312985, 0.0354136118863351,
// 		0.572620181693099, 1.23052181809354, 1.77201033589977, 1.99892600254856,
// 		1.82774777153906, 1.32150340107289, 0.665688655669804,
// 		0.0974104123257481, -0.185132278442815, -0.0981920960178549,
// 		0.295862641104712, 0.812875382315509, 1.21790298789847,
// 		1.31571177839441, 1.02612694679473, 0.41538994601773,
// 		-0.328486927610252, -0.966948372021386, -1.30145968806332,
// 		-1.24876003672666, -0.872018235473292, -0.355979307667573,
// 		0.064376352337198, 0.194349762816637, -0.0454329936412415,
// 		-0.588177028827961, -1.24608575751953, -1.78191393082972,
// 		-1.99952905260009, -1.81882800809393, -1.30634141239079,
// 		-0.649814544030704, -0.0864917897183621, 0.187452784624739,
// 		0.0916823675884667, -0.30794574853752, -0.825044498502473,
// 		-1.22455382201947, -1.31328278468164, -1.01447834632148,
// 		-0.397874115324407, 0.346290904954926, 0.979351994559375,
// 		1.30482418506763, 1.24287137615811, 0.860152068396031,
// 		0.343631263695088, -0.0716088622262446, -0.192923388376229,
// 		0.0556392882653005, 0.603805108246255, 1.26157478002193,
// 		1.79162178358796, 1.9998870134565, 1.80970414123669, 1.29109097882781,
// 		0.633998136624254, 0.0757517135156937, -0.189545271076459,
// 		-0.0849852167736799, 0.32010142191695, 0.837141334821687,
// 		1.23101332245223, 1.31061513605625, 1.00263401520258, 0.380279717884894,
// 		-0.364026451517952, -0.991566174465882, -1.30795009134998,
// 		-1.23678522720842, -0.848203631271908, -0.331345809316468,
// 		0.0786600705290479, 0.191268895871667, -0.0660304273436496,
// 		-0.619500994391327, -1.27698540986341, -1.80113169568941 };

float32_t inputSignal[1024] = {0,0.713737136,1.200363228,1.318952679,1.067980105,0.585211078,0.094321587,-0.181315234,-0.104672597,0.32199295,0.957577273,1.575777154,1.951426415,1.946484067,1.562770674,0.941272763,0.30828146,-0.111024001,-0.178480184,0.104539382,0.598079446,1.077662348,1.320755618,1.192548841,0.69820424,-0.018425155,-0.729130152,-1.207950952,-1.316922175,-1.058155205,-0.572337885,-0.084236612,0.183933019,0.098105294,-0.335833425,-0.973871361,-1.588634503,-1.956134593,-1.94130867,-1.549617999,-0.924961462,-0.294701892,0.117158383,0.17542898,-0.114887082,-0.610939395,-1.08719904,-1.322329918,-1.18450896,-0.682534437,0.036846661,0.744380348,1.215310897,1.314665228,1.048190572,0.559463465,0.07428734,-0.186332478,-0.091323272,0.349799916,0.9901514,1.601339819,1.960607533,1.9359014,1.536322098,0.908646998,0.281257149,-0.123074671,-0.172162787,0.125361738,0.623787326,1.096587324,1.323674561,1.176244806,0.666730731,-0.055260871,-0.75948482,-1.222442,-1.312183016,-1.038089163,-0.546591412,-0.064476623,0.188512608,0.084327758,-0.363889424,-1.006413763,-1.61389023,-1.964844219,-1.930263482,-1.52288597,-0.892332998,-0.267950101,0.128771846,0.168682821,-0.135960371,-0.636619648,-1.105824374,-1.324788583,-1.167757654,-0.650796158,0.073664136,0.774440693,1.229343252,1.309476769,1.027853965,0.533725322,0.054807274,-0.190472455,-0.077120036,0.378098916,1.022654823,1.626282904,1.968843689,1.924396195,1.509312647,0.876023087,0.254783583,-0.134248944,-0.164990351,0.14667997,0.649432766,1.1149074,1.325671072,1.159048828,0.634733785,-0.092052815,-0.789245131,-1.236013697,-1.306547768,-1.017487997,-0.520868784,-0.045282076,0.19221112,0.069701439,-0.392425331,-1.038870959,-1.63851504,-1.972605037,-1.918300872,-1.49560519,-0.859720888,-0.241760396,0.139505052,0.161086698,-0.157517496,-0.662223094,-1.123833647,-1.326321169,-1.150119708,-0.618546707,0.110423266,0.803895331,1.242452432,1.303397346,1.006994308,0.508025387,0.035903773,-0.193727758,-0.062073352,0.406865577,1.055058552,1.650583873,1.976127407,1.911978895,1.481766691,0.843430019,0.228883304,-0.144539313,-0.156973234,0.168469878,0.674987046,1.132600396,1.326738072,1.140971722,0.60223805,-0.128771853,-0.818388528,-1.248658611,-1.300026887,-0.996375973,-0.495198713,-0.026675075,0.195021579,0.054237213,-0.421416536,-1.07121399,-1.662486677,-1.979410002,-1.905431697,-1.467800269,-0.827154093,-0.216155035,0.149350925,0.152651381,-0.17953402,-0.687721043,-1.141204965,-1.326921031,-1.13160635,-0.585810967,0.147094945,0.832721992,1.254631439,1.296437828,0.9856361,0.482392341,0.017598655,-0.196091844,-0.046194508,0.436075058,1.087333662,1.67422076,1.982452075,1.898660764,1.453709071,0.81089672,0.203578281,-0.153939137,-0.148122613,0.190706795,0.700421511,1.149644708,1.326869351,1.122025124,0.569268641,-0.165388917,-0.846893031,-1.260370177,-1.292631653,-0.974777821,-0.469609841,-0.008677147,0.196937873,0.037946775,-0.45083797,-1.103413969,-1.685783471,-1.985252935,-1.891667631,-1.439496273,-0.794661499,-0.191155695,0.158303255,0.143388456,-0.20198505,-0.713084884,-1.157917018,-1.326582392,-1.112229625,-0.55261428,0.183650151,0.860898992,1.265874141,1.288609901,0.963804296,0.456854779,-8.69E-05,-0.197559037,-0.029495603,0.465702067,1.119451314,1.697172193,1.987811948,1.884453885,1.425165076,0.778452028,0.178889893,-0.16244264,-0.138450481,0.213365607,0.725707602,1.166019327,1.326059567,1.102221484,0.535851118,-0.201875036,-0.874737259,-1.271142701,-1.284374157,-0.952718711,-0.444130713,0.008690782,0.197954762,0.02084263,-0.480664124,-1.135442112,-1.708384352,-1.990128532,-1.877021161,-1.410718708,-0.76227189,-0.166783451,0.166356705,0.133310315,-0.224845261,-0.738286115,-1.173949105,-1.325300346,-1.092002383,-0.518982416,0.22005997,0.888405256,1.276175282,1.279926058,0.941524278,0.43144119,-0.017132125,-0.198124531,-0.011989542,0.495720887,1.151382786,1.719417411,1.992202161,1.869371144,1.396160422,0.746124665,0.154838905,-0.170044921,-0.127969629,0.236420783,0.75081688,1.181703862,1.324304253,1.081574051,0.502011459,-0.238201361,-0.901900445,-1.280971364,-1.27526729,-0.930224232,-0.418789749,0.025408402,0.19806788,0.002938076,-0.510869079,-1.167269767,-1.730268874,-1.994032365,-1.861505569,-1.381493495,-0.730013919,-0.143058754,0.173506811,0.122430145,-0.248088919,-0.763296367,-1.189281148,-1.323070868,-1.070938269,-0.484941554,0.256295626,0.915220333,1.285530483,1.270399585,0.918821833,0.40617992,-0.033517172,-0.1977844,0.006309982,0.526105401,1.183099498,1.740936286,1.995618727,1.853426219,1.366721226,0.713943211,0.131445452,-0.176741956,-0.116693635,0.259846393,0.775721053,1.196678554,1.321599825,1.060096864,0.467776035,-0.274339192,-0.928362462,-1.289852229,-1.265324728,-0.907320365,-0.39361522,0.04145604,0.197273739,-0.0157528,-0.541426527,-1.198868434,-1.751417232,-1.996960888,-1.845134926,-1.35184694,-0.697916085,-0.120001416,0.17974999,0.110761916,-0.271689905,-0.78808743,-1.203893714,-1.319890814,-1.049051713,-0.450518255,0.292328502,0.941324421,1.293936248,1.260044548,0.895723131,0.381099154,-0.049222647,-0.196535598,0.025388497,0.556829114,1.214573041,1.761709341,1.998058543,1.836633567,1.336873981,0.681936076,0.108729019,-0.182530604,-0.104636855,0.283616136,0.800392003,1.210924302,1.31794358,1.037804737,0.43317159,-0.310260007,-0.954103837,-1.297782241,-1.254560924,-0.884033459,-0.368635215,0.05681468,0.195569736,-0.035215145,-0.572309795,-1.230209799,-1.771810283,-1.998911442,-1.827924071,-1.321805715,-0.666006703,-0.097630591,0.185083543,0.098320365,-0.295621742,-0.812631286,-1.217768035,-1.315757924,-1.026357908,-0.415739438,0.328130174,0.966698383,1.301389965,1.248875782,0.872254696,0.356226883,-0.064229868,-0.194375964,0.045230767,0.587865182,1.245775201,1.78171777,1.999519393,1.81900841,1.30664553,0.650131472,0.08670842,-0.187408609,-0.091814406,0.307703364,0.824801813,1.224422673,1.313333703,1.014713243,0.398225213,-0.345935484,-0.979105771,-1.304759233,-1.242991092,-0.860390209,-0.343877623,0.071465982,0.192954151,-0.055433344,-0.603491871,-1.261265756,-1.791429559,-1.999882257,-1.809888605,-1.291396832,-0.634313877,-0.075964751,0.189505657,0.085120983,-0.319857619,-0.836900129,-1.230886021,-1.310670828,-1.002872806,-0.380632353,0.363672434,0.991323762,1.307889912,1.236908872,0.848443384,0.331590883,-0.078520837,-0.191304221,0.065820807,0.619186434,1.276677988,1.800943451,1.999999951,1.800566722,1.276063046,0.618557392,0.065401785,-0.191374599,-0.07824215,0.332081109,0.848922796,1.237155928,1.307769267,0.990838706,0.362964312,-0.381337534,-1.003350156,-1.310781926,-1.230631187,-0.836417626,-0.319370097,0.085392294,0.189426154,-0.076391043,-0.63494543,-1.292008437,-1.810257291,-1.999872449,-1.791044873,-1.260647615,-0.602865477,-0.055021677,0.193015403,0.071180003,-0.344370416,-0.860866392,-1.243230285,-1.304629042,-0.978613097,-0.345224561,0.398927315,1.015182803,1.313435254,1.224160146,0.824316355,0.307218682,-0.092078257,-0.187319983,0.087141894,0.650765398,1.30725366,1.81936897,1.99949978,1.781325213,1.245153999,0.587241575,0.044826539,-0.194428092,-0.063936684,0.356722105,0.872727515,1.249107032,1.301250234,0.966198179,0.327416589,-0.416438322,-1.026819593,-1.31584993,-1.217497901,-0.812143012,-0.295140036,0.098576676,0.1849858,-0.098071159,-0.666642861,-1.322410233,-1.828276422,-1.998882028,-1.771409944,-1.229585676,-0.571689111,-0.034818437,0.195612745,0.056514379,-0.369132728,-0.884502779,-1.254784152,-1.297632975,-0.953596195,-0.309543901,0.433867121,1.038258466,1.318026046,1.210646651,0.79990105,0.28313754,-0.104885546,-0.18242375,0.10917659,0.682574327,1.337474751,1.836977631,1.998019335,1.761301312,1.213946136,0.556211489,0.02499939,-0.196569495,-0.048915319,0.381598819,0.896188817,1.260259674,1.293777455,0.940809432,0.291610016,-0.451210295,-1.049497407,-1.319963747,-1.203608636,-0.787593939,-0.271214554,0.11100291,0.179634033,-0.120455898,-0.698556289,-1.352443828,-1.845470623,-1.996911894,-1.751001605,-1.198238888,-0.540812096,-0.015371372,0.197298531,0.041141777,-0.394116897,-0.907782284,-1.265531677,-1.289683921,-0.927840221,-0.273618468,0.468464449,1.060534445,1.321663234,1.196386142,0.775225162,0.25937442,-0.116926856,-0.176616908,0.131906751,0.714585226,1.367314098,1.853753475,1.995559959,1.740513154,1.182467453,0.525494297,0.005936308,-0.197800099,-0.033196068,0.40668347,0.919279853,1.270598283,1.285352673,0.914690934,0.255572805,-0.485626208,-1.071367661,-1.323124764,-1.188981494,-0.762798216,-0.247620456,0.122655519,0.173372686,-0.143526773,-0.730657604,-1.382082216,-1.861824309,-1.993963836,-1.729838333,-1.166635363,-0.510261438,0.003303921,0.198074498,0.025080551,-0.419295031,-0.930678221,-1.275457664,-1.280784068,-0.901363987,-0.237476587,0.502692219,1.08199518,1.32434865,1.181397063,0.750316611,0.235955962,-0.128187085,-0.169901734,0.155313547,0.746769877,1.396744862,1.869681296,1.992123887,1.718979559,1.150746166,0.495116839,-0.012347486,-0.198122085,-0.016797624,0.431948063,0.941974104,1.280108038,1.275978516,0.887861837,0.219333385,-0.519659149,-1.092415176,-1.32533526,-1.173635258,-0.737783868,-0.224384213,0.133519783,0.166204475,-0.167264617,-0.762918487,-1.411298734,-1.877322654,-1.99004053,-1.707939288,-1.134803419,-0.480063802,0.021192602,0.197943268,0.00834973,-0.444639036,-0.953164246,-1.284547675,-1.270936486,-0.874186981,-0.201146784,0.536523693,1.102625871,1.326085015,1.165698531,0.725203519,0.212908461,-0.138651893,-0.162281387,0.179377482,0.779099867,1.425740557,1.884746651,1.987714239,1.696720017,1.11881069,0.465105601,-0.029837536,-0.197538515,0.000260652,0.45736441,0.96424541,1.28877489,1.265658498,0.860341956,0.182920375,-0.553282565,-1.112625538,-1.326598395,-1.157589373,-0.712579106,-0.201531935,0.143581746,0.158133001,-0.191649606,-0.795310438,-1.440067079,-1.891951603,-1.98514554,-1.685324286,-1.102771557,-0.450245489,0.038280601,0.196908345,-0.009031,-0.470120638,-0.975214386,-1.29278805,-1.260145131,-0.846329342,-0.164657763,0.569932507,1.122412498,1.326875932,1.149310316,0.699914181,0.190257838,-0.148307718,-0.153759907,0.204078409,0.811546613,1.454275075,1.898935878,1.982335019,1.67375467,1.086689607,0.435486692,-0.046520163,-0.196053335,0.017958755,0.482904161,0.98606799,1.296585569,1.254397015,0.832151754,0.146362556,-0.586470285,-1.13198512,-1.326918213,-1.140863929,-0.687212303,-0.179089348,0.152828238,0.149162745,-0.216661275,-0.827804798,-1.468361342,-1.905697891,-1.979283311,-1.662013786,-1.070568435,-0.420832411,0.054554635,0.194974113,-0.027041317,-0.495711414,-0.996803061,-1.300165912,-1.248414839,-0.817811849,-0.128038374,0.602892691,1.141341825,1.326725883,1.132252822,0.674477039,0.168029617,-0.157141783,-0.144342212,0.229395548,0.844081391,1.482322708,1.912236108,1.975991111,1.650104289,1.054411642,0.406285821,-0.06238248,-0.193671366,0.036276051,0.508538826,1.007416469,1.303527597,1.242199342,0.803312319,0.109688843,-0.619196545,-1.150481085,-1.326299637,-1.123479641,-0.661711963,-0.157081769,0.161246882,0.139299061,-0.242278537,-0.860372782,-1.496156025,-1.918549046,-1.972459166,-1.638028871,-1.038222838,-0.391850068,0.070002214,0.192145831,-0.045660282,-0.521382818,-1.017905109,-1.306669188,-1.235751322,-0.788655896,-0.091317593,0.635378695,1.15940142,1.325640228,1.114547071,0.648920655,0.146248902,-0.165142114,-0.134034097,0.25530751,0.87667536,1.509858176,1.924635274,1.968688276,1.625790261,1.022005635,0.377528271,-0.077412403,-0.190398302,0.055191299,0.534239806,1.028265904,1.309589305,1.229071627,0.773845347,0.072928262,-0.651436016,-1.168101405,-1.324748462,-1.105457831,-0.6361067,-0.135534083,0.168826108,0.128548178,-0.268479703,-0.892985503,-1.523426069,-1.930493411,-1.964679299,-1.613391224,-1.005763653,-0.363323519,0.084611662,0.188429626,-0.064866356,-0.547106204,-1.038495808,-1.312286615,-1.222161163,-0.758883475,-0.054524488,0.667365412,1.176579663,1.323625197,1.096214678,0.623273685,0.124940351,-0.172297547,-0.12284222,0.281792314,0.909299592,1.536856646,1.936122127,1.960433145,1.600834561,0.989500514,0.349238875,-0.09159866,-0.186240705,0.07468267,0.55997842,1.048591803,1.314759839,1.215020886,0.743773119,0.036109917,-0.68316382,-1.18483487,-1.322271348,-1.086820403,-0.610425203,-0.114470717,0.175555164,0.116917189,-0.295242505,-0.925613999,-1.550146876,-1.941520146,-1.955950776,-1.588123109,-0.973219843,-0.335277366,0.098372117,0.183832492,-0.084637424,-0.57285286,-1.058550904,-1.31700775,-1.20765181,-0.728517154,-0.017688195,0.698828204,1.192865754,1.320687883,1.077277834,0.597564849,0.104128157,-0.178597744,-0.110774105,0.308827406,0.941925098,1.56329376,1.946686243,1.95123321,1.575259739,0.956925268,0.321441994,-0.104930806,-0.181205996,0.094727768,0.585725929,1.068370154,1.319029173,1.200054997,0.713118486};

// float32_t inputSignal[16] = {10.0,20.0,
// 							10.0,20.0,
// 							10.0,20.0,
// 							10.0,20.0,
// 							10.0,20.0,
// 							10.0,20.0,
// 							10.0,20.0,
// 							10.0,20.0,};

SigProcThread::SigProcThread() {
   
    // NEED TO DO CHECKS
};

void SigProcThread::Initialize() {
    LOG_DBG("SigProc::%s -- initializing Sig Processing", __FUNCTION__);

    if (id == nullptr) {
        LOG_DBG("SigProc::%s -- making thread", __FUNCTION__);
        id = k_thread_create(
            &sig_proc_thread_data, sig_proc_stack_area,
            K_THREAD_STACK_SIZEOF(sig_proc_stack_area),
            SigProcThread::RunThreadSequence,
            this, NULL, NULL,
            SIG_PROC_THREAD_PRIORITY, 0, K_NO_WAIT
        );

        k_thread_name_set(id, "SigProcThread");
        LOG_DBG("SigProc::%s -- thread create successful", __FUNCTION__);
    }
};

void SigProcThread::Run() {
    uint8_t message = 0;
    while (true) {
        if (message_queue.get_with_blocking_wait(message)) {
            uint8_t message_enum = static_cast<SigProcThreadMessage>(message);
		    LOG_DBG("SigProc::%s -- received message: %u at: %u ms", __FUNCTION__, message_enum, k_uptime_get_32());
            switch (message_enum) {
                case COMPUTE_FFT_RESULTS:
					TestValuesWooHoo();
                   // ComputeSingleSideFFT();
                    break;
                case COMPUTE_POWER_RESULTS:
					TestValuesWooHoo();
                    ComputeSingleSidePower();
                    break;
                case COMPUTE_BANDPOWER_RESULTS:
					TestValuesWooHoo();
                    ComputeSingleSidePower();
                    //ComputeBandPowers(PowerBands::DELTA);
                    break;
                case COMPUTE_RELATIVEPOWER_RESULTS:
                    ComputeRelativeBandPowers();
                    break;
                case INVALID:
                    break;
                default:
                    break;
            }
        }
    }
};

void SigProcThread::TestValuesWooHoo()
{
    printk("\nFilling up allChannels with sample data Woo Hoo\n");
	for (int i = 0; i < RAW_SAMPLE_NUMBER; i++) {
       allChannels.set_at(inputSignal[i], i, 0);
    }
    allChannels.rawFFT(0);
    allChannels.prettyPrint();

}

void SigProcThread::ComputeSingleSideFFT()
{
	
    printk("\nPrint single-sided FFT results:\n");
	
	for (int i = 0; i < CHANNELS; i++) {
        //Compute the singeSideFFT for all channels
		channelFFTResults.emplace_back(allChannels.singleSideFFT(i));
        channelFFTResults[i].prettyPrint();
    }
}
 

void SigProcThread::ComputeSingleSidePower()
{
    printk("\nPrint single-sided power results:\n");
    for (int i = 0; i < CHANNELS; i++) 
    {
        // Compute the singleSidePower for all channels
        channelPowerResults.emplace_back(allChannels.singleSidePower(i));
        channelPowerResults[i].prettyPrint();

    }
    
}

void SigProcThread::ComputeBandPowers(const PowerBands powerBand)
{
	printk("\nPrint band power results:\n");
    uint8_t powerBand_enum = static_cast<PowerBands>(powerBand);
    // Computation of bandpowers
    switch (powerBand_enum) {
        case DELTA:{
            for (int i = 0; i < CHANNELS; i++) {   
				ArmMatrixWrapper<512, 1> channelBandPowerResult;
				 
                channelBandPowers[i][0] = channelBandPowerResult.singleSideBandPower(i, SAMPLE_FREQ, RAW_SAMPLE_NUMBER, 0);
				printk("\nPrint delta power results: %.4f\n", channelBandPowers[i][0]);
			}
            break;
        }   
        case THETA:{
            for (int i = 0; i < CHANNELS; i++) {   
                channelBandPowers[i][1] = channelPowerResults[i].singleSideBandPower(i, SAMPLE_FREQ, RAW_SAMPLE_NUMBER, 0);
				printk("\nPrint theta power results: %.4f\n", channelBandPowers[i][1]);
            }
            break;
        }
        case ALPHA:{
            for (int i = 0; i < CHANNELS; i++) {   
                channelBandPowers[i][2] = channelPowerResults[i].singleSideBandPower(i, SAMPLE_FREQ, RAW_SAMPLE_NUMBER, 0);
				printk("\nPrint alpha power results: %.4f\n", channelBandPowers[i][2]);
		    }
            break;
        }
        case BETA:{
            for (int i = 0; i < CHANNELS; i++) {   
                channelBandPowers[i][3] = channelPowerResults[i].singleSideBandPower(i, SAMPLE_FREQ, RAW_SAMPLE_NUMBER, 0);
				printk("\nPrint beta power results: %.4f\n", channelBandPowers[i][3]);
			}
            break;
        }
        case INVALID:
            break;
        default:
            break;
    }
}

void SigProcThread::ComputeRelativeBandPowers()
{
     for (int i = 0; i < CHANNELS; i++) 
    {
        // Each channel's power spectrum calculates the relative band powers of the 4 bands and stores them into 
        // a 2D array. Outer index denotes the channel number, inner index denotes the band power value
        channelRelativeBandPowers[i] = channelPowerResults[i].singleSideRelativeBandPower(channelBandPowers[i]);
    }
}


